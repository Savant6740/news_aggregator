<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0a0a0a">
<title>Daily Brief</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;1,400&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg:       #0a0a0a;
    --surface:  #141414;
    --border:   #222;
    --gold:     #c9a66b;
    --gold2:    #e8c98a;
    --text:     #e8e2da;
    --muted:    #666;
    --red:      #e05454;
    --green:    #52c97a;
    --blue:     #5b9cf6;
  }

  html, body {
    height: 100%;
    background: var(--bg);
    color: var(--text);
    font-family: 'JetBrains Mono', monospace;
    overflow: hidden;
    -webkit-tap-highlight-color: transparent;
    user-select: none;
  }

  /* â”€â”€ Setup screen â”€â”€ */
  #setup {
    display: none;
    position: fixed; inset: 0;
    background: var(--bg);
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 32px 24px;
    gap: 20px;
    z-index: 100;
  }
  #setup.visible { display: flex; }

  .setup-title {
    font-family: 'Playfair Display', serif;
    font-size: 26px;
    font-weight: 700;
    color: var(--gold);
    text-align: center;
  }
  .setup-sub {
    font-size: 10px;
    color: var(--muted);
    letter-spacing: 0.15em;
    text-transform: uppercase;
    text-align: center;
    line-height: 1.8;
  }
  .setup-field {
    width: 100%;
    max-width: 360px;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }
  .setup-label {
    font-size: 9px;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--muted);
  }
  .setup-input {
    background: var(--surface);
    border: 1px solid var(--border);
    color: var(--text);
    padding: 12px 14px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    border-radius: 6px;
    outline: none;
    width: 100%;
    transition: border-color 0.2s;
  }
  .setup-input:focus { border-color: var(--gold); }
  .setup-input::placeholder { color: #333; }

  .setup-hint {
    font-size: 9px;
    color: #444;
    letter-spacing: 0.05em;
    line-height: 1.6;
  }
  .setup-hint a { color: var(--gold); text-decoration: none; }

  .btn-save {
    background: var(--gold);
    color: #0a0a0a;
    border: none;
    padding: 14px 40px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    font-weight: 500;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    border-radius: 6px;
    cursor: pointer;
    margin-top: 8px;
    width: 100%;
    max-width: 360px;
    transition: opacity 0.15s;
  }
  .btn-save:active { opacity: 0.75; }

  /* â”€â”€ Main screen â”€â”€ */
  #main {
    display: none;
    position: fixed; inset: 0;
    flex-direction: column;
    align-items: center;
    justify-content: space-between;
    padding: 48px 28px 52px;
  }
  #main.visible { display: flex; }

  /* Top bar */
  .topbar {
    width: 100%;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
  }
  .masthead {
    font-family: 'Playfair Display', serif;
  }
  .masthead-title {
    font-size: 22px;
    font-weight: 700;
    color: var(--text);
    line-height: 1;
  }
  .masthead-title em { color: var(--gold); font-style: italic; }
  .masthead-sub {
    font-size: 8px;
    color: var(--muted);
    letter-spacing: 0.2em;
    text-transform: uppercase;
    margin-top: 5px;
  }
  .settings-btn {
    background: none;
    border: 1px solid var(--border);
    color: var(--muted);
    width: 36px; height: 36px;
    border-radius: 50%;
    font-size: 14px;
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    transition: border-color 0.2s, color 0.2s;
    flex-shrink: 0;
  }
  .settings-btn:active { border-color: var(--gold); color: var(--gold); }

  /* Center â€” big trigger button */
  .center {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 32px;
    flex: 1;
    justify-content: center;
  }

  .date-display {
    text-align: center;
  }
  .date-day {
    font-family: 'Playfair Display', serif;
    font-size: 64px;
    font-weight: 700;
    color: var(--text);
    line-height: 1;
    letter-spacing: -0.03em;
  }
  .date-month {
    font-size: 10px;
    color: var(--muted);
    letter-spacing: 0.25em;
    text-transform: uppercase;
    margin-top: 6px;
  }

  /* The big button */
  .trigger-wrap {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .trigger-ring {
    position: absolute;
    width: 180px; height: 180px;
    border-radius: 50%;
    border: 1px solid rgba(201,166,107,0.15);
    animation: pulse-ring 3s ease-in-out infinite;
  }
  .trigger-ring:nth-child(2) {
    width: 210px; height: 210px;
    animation-delay: 1s;
    border-color: rgba(201,166,107,0.07);
  }

  @keyframes pulse-ring {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.04); opacity: 0.5; }
  }

  .trigger-btn {
    position: relative;
    width: 150px; height: 150px;
    border-radius: 50%;
    border: 1.5px solid var(--gold);
    background: radial-gradient(circle at 40% 35%, #1e1a14, #0a0a0a);
    cursor: pointer;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 6px;
    box-shadow:
      0 0 40px rgba(201,166,107,0.08),
      inset 0 1px 0 rgba(255,255,255,0.04);
    transition: transform 0.15s, box-shadow 0.15s;
    -webkit-tap-highlight-color: transparent;
  }

  .trigger-btn:active {
    transform: scale(0.95);
    box-shadow: 0 0 60px rgba(201,166,107,0.2), inset 0 1px 0 rgba(255,255,255,0.04);
  }

  .trigger-btn.loading {
    border-color: var(--blue);
    box-shadow: 0 0 40px rgba(91,156,246,0.15);
    animation: none;
    cursor: default;
  }
  .trigger-btn.success {
    border-color: var(--green);
    box-shadow: 0 0 40px rgba(82,201,122,0.2);
  }
  .trigger-btn.error {
    border-color: var(--red);
    box-shadow: 0 0 40px rgba(224,84,84,0.2);
  }

  .trigger-icon {
    font-size: 32px;
    line-height: 1;
    transition: transform 0.3s;
  }
  .trigger-btn.loading .trigger-icon {
    animation: spin 1.2s linear infinite;
  }
  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  .trigger-label {
    font-size: 8px;
    letter-spacing: 0.25em;
    text-transform: uppercase;
    color: var(--gold);
    transition: color 0.2s;
  }
  .trigger-btn.loading .trigger-label { color: var(--blue); }
  .trigger-btn.success .trigger-label { color: var(--green); }
  .trigger-btn.error .trigger-label { color: var(--red); }

  /* Status */
  .status-area {
    min-height: 48px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
  }
  .status-line {
    font-size: 10px;
    letter-spacing: 0.1em;
    color: var(--muted);
    text-align: center;
    line-height: 1.7;
  }
  .status-line.ok   { color: var(--green); }
  .status-line.err  { color: var(--red); }
  .status-line.info { color: var(--blue); }

  /* Bottom â€” last run info */
  .bottom {
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .divider {
    width: 100%;
    height: 1px;
    background: var(--border);
  }

  .info-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .info-label {
    font-size: 8px;
    color: var(--muted);
    letter-spacing: 0.15em;
    text-transform: uppercase;
  }
  .info-value {
    font-size: 10px;
    color: var(--text);
    letter-spacing: 0.05em;
  }
  .info-value.gold { color: var(--gold); }
  .info-value.green { color: var(--green); }
  .info-value.blue { color: var(--blue); }

  .site-link {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 12px;
    border: 1px solid var(--border);
    border-radius: 8px;
    text-decoration: none;
    color: var(--muted);
    font-size: 9px;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    transition: border-color 0.2s, color 0.2s;
  }
  .site-link:active { border-color: var(--gold); color: var(--gold); }

  /* Toast */
  .toast {
    position: fixed;
    bottom: 24px; left: 50%;
    transform: translateX(-50%) translateY(80px);
    background: var(--surface);
    border: 1px solid var(--border);
    color: var(--text);
    padding: 10px 20px;
    border-radius: 20px;
    font-size: 11px;
    letter-spacing: 0.08em;
    white-space: nowrap;
    transition: transform 0.3s cubic-bezier(0.34,1.56,0.64,1);
    z-index: 200;
  }
  .toast.show { transform: translateX(-50%) translateY(0); }
</style>
</head>
<body>

<!-- â”€â”€ Setup screen â”€â”€ -->
<div id="setup">
  <div class="setup-title">The Daily <em>Brief</em></div>
  <div class="setup-sub">One-time setup<br>Enter your GitHub details</div>

  <div class="setup-field">
    <div class="setup-label">GitHub Username</div>
    <input class="setup-input" id="s-owner" type="text" placeholder="your-github-username" autocomplete="off" autocorrect="off" spellcheck="false">
  </div>

  <div class="setup-field">
    <div class="setup-label">Repository Name</div>
    <input class="setup-input" id="s-repo" type="text" placeholder="news-digest" autocomplete="off" autocorrect="off" spellcheck="false">
  </div>

  <div class="setup-field">
    <div class="setup-label">GitHub Personal Access Token</div>
    <input class="setup-input" id="s-token" type="password" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx" autocomplete="off" spellcheck="false">
    <div class="setup-hint">
      Go to github.com â†’ Settings â†’ Developer settings â†’ Personal access tokens â†’ Fine-grained tokens â†’ New token<br>
      Permission needed: <strong style="color:var(--gold)">Actions â†’ Read and Write</strong>
    </div>
  </div>

  <div class="setup-field">
    <div class="setup-label">GitHub Pages URL (your digest site)</div>
    <input class="setup-input" id="s-site" type="url" placeholder="https://yourusername.github.io/news-digest" autocomplete="off">
  </div>

  <button class="btn-save" onclick="saveSetup()">Save & Continue</button>
</div>

<!-- â”€â”€ Main screen â”€â”€ -->
<div id="main">
  <div class="topbar">
    <div class="masthead">
      <div class="masthead-title">Daily <em>Brief</em></div>
      <div class="masthead-sub">Bengaluru Edition</div>
    </div>
    <button class="settings-btn" onclick="showSetup()" title="Settings">âš™</button>
  </div>

  <div class="center">
    <div class="date-display">
      <div class="date-day" id="date-day">--</div>
      <div class="date-month" id="date-month">--- ----</div>
    </div>

    <div class="trigger-wrap">
      <div class="trigger-ring"></div>
      <div class="trigger-ring"></div>
      <button class="trigger-btn" id="trigger-btn" onclick="triggerWorkflow()">
        <div class="trigger-icon" id="trigger-icon">ğŸ“°</div>
        <div class="trigger-label" id="trigger-label">Run Digest</div>
      </button>
    </div>

    <div class="status-area">
      <div class="status-line" id="status-line">Tap to trigger today's digest</div>
    </div>
  </div>

  <div class="bottom">
    <div class="divider"></div>
    <div class="info-row">
      <div class="info-label">Last run</div>
      <div class="info-value gold" id="last-run">â€”</div>
    </div>
    <div class="info-row">
      <div class="info-label">Status</div>
      <div class="info-value" id="last-status">â€”</div>
    </div>
    <div class="info-row">
      <div class="info-label">This month</div>
      <div class="info-value" id="monthly-count">â€” runs</div>
    </div>
    <a class="site-link" id="site-link" href="#" target="_blank">
      ğŸŒ Open Digest Site
    </a>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
  const STORAGE_KEY = 'daily_brief_config';
  const HISTORY_KEY = 'daily_brief_history';

  // â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function getConfig() {
    try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {}; }
    catch { return {}; }
  }

  function getHistory() {
    try { return JSON.parse(localStorage.getItem(HISTORY_KEY)) || []; }
    catch { return []; }
  }

  function saveHistory(entry) {
    const h = getHistory();
    h.unshift(entry);
    localStorage.setItem(HISTORY_KEY, JSON.stringify(h.slice(0, 60)));
  }

  function showToast(msg, duration = 2500) {
    const t = document.getElementById('toast');
    t.textContent = msg;
    t.classList.add('show');
    setTimeout(() => t.classList.remove('show'), duration);
  }

  function setStatus(msg, type = '') {
    const el = document.getElementById('status-line');
    el.textContent = msg;
    el.className = 'status-line' + (type ? ' ' + type : '');
  }

  function setBtnState(state) {
    const btn  = document.getElementById('trigger-btn');
    const icon = document.getElementById('trigger-icon');
    const lbl  = document.getElementById('trigger-label');
    btn.className = 'trigger-btn ' + state;
    const states = {
      idle:    { icon: 'ğŸ“°', label: 'Run Digest' },
      loading: { icon: 'âŸ³', label: 'Triggering' },
      success: { icon: 'âœ“', label: 'Triggered!' },
      error:   { icon: 'âœ•', label: 'Failed' },
    };
    const s = states[state] || states.idle;
    icon.textContent = s.icon;
    lbl.textContent  = s.label;
  }

  function updateDate() {
    const now = new Date();
    const ist = new Date(now.toLocaleString('en-US', { timeZone: 'Asia/Kolkata' }));
    document.getElementById('date-day').textContent =
      ist.getDate().toString().padStart(2, '0');
    document.getElementById('date-month').textContent =
      ist.toLocaleDateString('en-IN', { month: 'long', year: 'numeric', timeZone: 'Asia/Kolkata' }).toUpperCase();
  }

  function updateStats() {
    const history = getHistory();
    const now = new Date();
    const monthKey = `${now.getFullYear()}-${now.getMonth()}`;

    const thisMonth = history.filter(h => {
      const d = new Date(h.ts);
      return `${d.getFullYear()}-${d.getMonth()}` === monthKey && h.ok;
    });

    document.getElementById('monthly-count').textContent =
      `${thisMonth.length} run${thisMonth.length !== 1 ? 's' : ''} this month`;

    if (history.length > 0) {
      const last = history[0];
      const lastDate = new Date(last.ts);
      document.getElementById('last-run').textContent =
        lastDate.toLocaleString('en-IN', {
          day: '2-digit', month: 'short', hour: '2-digit', minute: '2-digit',
          timeZone: 'Asia/Kolkata'
        });
      const statusEl = document.getElementById('last-status');
      if (last.ok) {
        statusEl.textContent = 'âœ“ Triggered successfully';
        statusEl.className = 'info-value green';
      } else {
        statusEl.textContent = 'âœ• ' + (last.error || 'Failed');
        statusEl.className = 'info-value';
        statusEl.style.color = 'var(--red)';
      }
    }
  }

  // â”€â”€ Setup â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function showSetup() {
    const cfg = getConfig();
    document.getElementById('s-owner').value = cfg.owner || '';
    document.getElementById('s-repo').value  = cfg.repo  || '';
    document.getElementById('s-token').value = cfg.token || '';
    document.getElementById('s-site').value  = cfg.site  || '';
    document.getElementById('setup').classList.add('visible');
    document.getElementById('main').classList.remove('visible');
  }

  function saveSetup() {
    const owner = document.getElementById('s-owner').value.trim();
    const repo  = document.getElementById('s-repo').value.trim();
    const token = document.getElementById('s-token').value.trim();
    const site  = document.getElementById('s-site').value.trim();

    if (!owner || !repo || !token) {
      showToast('âš  Please fill in all required fields');
      return;
    }

    localStorage.setItem(STORAGE_KEY, JSON.stringify({ owner, repo, token, site }));
    document.getElementById('site-link').href = site || '#';
    document.getElementById('setup').classList.remove('visible');
    document.getElementById('main').classList.add('visible');
    showToast('âœ“ Saved!');
    updateStats();
  }

  // â”€â”€ Trigger â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function triggerWorkflow() {
    const btn = document.getElementById('trigger-btn');
    if (btn.classList.contains('loading')) return;

    const cfg = getConfig();
    if (!cfg.token || !cfg.owner || !cfg.repo) {
      showToast('âš  Setup not complete');
      showSetup();
      return;
    }

    setBtnState('loading');
    setStatus('Contacting GitHub...', 'info');

    const url = `https://api.github.com/repos/${cfg.owner}/${cfg.repo}/actions/workflows/news_digest.yml/dispatches`;

    try {
      const res = await fetch(url, {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${cfg.token}`,
          'Accept': 'application/vnd.github+json',
          'X-GitHub-Api-Version': '2022-11-28',
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ ref: 'main' }),
      });

      if (res.status === 204) {
        setBtnState('success');
        setStatus('Workflow triggered! Site updates in ~15 mins.', 'ok');
        saveHistory({ ts: Date.now(), ok: true });
        showToast('ğŸ“° Digest running â€” check back in 15 mins');

        setTimeout(() => {
          setBtnState('idle');
          setStatus('Tap to trigger today\'s digest');
        }, 4000);

      } else if (res.status === 401) {
        throw new Error('Invalid token â€” check your PAT');
      } else if (res.status === 404) {
        throw new Error('Repo or workflow not found');
      } else {
        const body = await res.text();
        throw new Error(`GitHub returned ${res.status}`);
      }

    } catch (err) {
      setBtnState('error');
      setStatus(err.message, 'err');
      saveHistory({ ts: Date.now(), ok: false, error: err.message });
      showToast('âœ• ' + err.message, 3500);

      setTimeout(() => {
        setBtnState('idle');
        setStatus('Tap to trigger today\'s digest');
      }, 4000);
    }

    updateStats();
  }

  // â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function init() {
    updateDate();
    setInterval(updateDate, 60000);

    const cfg = getConfig();
    if (!cfg.token || !cfg.owner || !cfg.repo) {
      showSetup();
    } else {
      document.getElementById('site-link').href = cfg.site || '#';
      document.getElementById('main').classList.add('visible');
      updateStats();
    }
  }

  init();
</script>
</body>
</html>
